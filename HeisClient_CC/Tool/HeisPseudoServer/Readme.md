# heis疑似サーバ

## 概要

本ソフトは、heis対戦用サーバの動作を模擬するソフトウェアです。
CC[^CC]を接続することで、CCの動作確認・デバッグに使用することを想定しています。



## 動作環境・必須コンポーネント

PS[^PS]は、Linux OS上で動作します。

また、最低限以下のコンポーネントが必要となります。

- CMake



## 機能

PSは、TCP接続された2つのクライアント(先攻, 後攻)に対して、シナリオファイル(後述)で指定されたJSONを送受信します。



## シナリオファイル

PSの動作を制御するためのファイルです。
HeisClient_CC/setting/PseudoServer/filesに置いてください。

シナリオファイルには、コマンドを記述します。
コマンドの書式は以下です。

```Text
コマンド名 引数1 引数2 ... 対象
```

"対象"はコマンドを適用する対象を表し、先攻プレイヤー or 後攻プレイヤーを指定します。
先攻を指定する場合は"first"、後攻を指定する場合は"second"を指定してください。

コマンドの一覧については後述します。

シナリオファイルを作成したら、PS設定ファイルの"scenario_file_name"を、作成したシナリオファイルの名前に変更してください[^設定]。



## コマンド一覧

PSで利用可能なコマンドを以下に示します。

### recv

JSONを受信します。

#### 書式

```
recv TO [FILENAME]
```



#### 引数

1. *TO*: 受信したJSONの出力対象。"print" or "write"を指定します。"print"を指定した場合はJSONを標準出力に表示、"file"を指定した場合は*FILENAME*で指定したファイルに書き込みます。
2. *FILENAME*: 書き込み先のファイル名。*TO*に"file"を指定した場合にのみ有効です。



### send

JSONを送信します。

#### 書式

```Text
recv FROM [JSON] [FILENAME]
```



#### 引数

1. *FROM*: 送信するJSONの読み込み元。"msg" or "file"を指定します。"msg"を指定した場合は*JSON*に記述したJSONを、"file"を指定した場合は*FILENAME*で指定したファイルから読みだしたJSONを送信します。
2. *JSON*: 送信するJSON。*FROM*に"msg"を指定した場合にのみ有効です。
3. *FILENAME*: JSON読み込み元のファイル名。*FROM*に"file"を指定した場合にのみ有効です。



## シナリオファイルの記述例

以下に、シナリオファイルの記述例を示します。

```Text
recv print first
send msg {"text": "hello,world!"} second
send file json.txt second
```



この場合、PSは以下に示す動作を行います。

1. 先攻プレイヤーからJSONを1回受信して標準出力に出力します。
2. {"text": "hello,world!"}というJSONを後攻プレイヤーに送信します。
3. json.txtに記載されているJSONを読み出し、後攻プレイヤーに送信します。

サンプルのシナリオファイルとして、"scenario_sample.txt"というファイルを用意しております。
そちらも併せてご覧ください。



## ビルド手順

PSは、CMakeによりビルドできます。

```bash
$ cd HeisClient_CC/Tool/HeisPseudoServer
$ cmake .
$ make
```



## 実行手順

コマンドラインから、引数なしでPSを起動できます。

PSの実行ファイルは、HeisClient_CC/Tool/HeisPseudoServer/binにあります。

PSを起動したら、CCを先攻・後攻の順にオンラインモードで起動し、PSに接続してください。
接続が完了すると、PSによるJSONの送受信がスタートします。

```bash
$ cd HeisClient_CC/Tool/HeisPseudoServer/bin
$ ./HeisPseudoServer.exe
CCをIPアドレス: 127.0.0.1, ポート番号: 20000に接続してください
(先攻プレイヤーが接続する)
CCをIPアドレス: 127.0.0.1, ポート番号: 20001に接続してください
(CCのオンラインモード設定ファイルを書き換え、接続先を変更する)
(後攻プレイヤーが接続する)
...
```



## ライセンス

PSは、パブリック・ドメインです。 誰でもご自由に利用・再配布などが可能です。
ただし、ご利用にあたって生じた損害等に関して、私(KonnoRyo2500)は一切の責任を負いません。 自己責任でのご利用をお願いいたします。



## コントリビューティング

PSの修正や機能追加をご希望の際は、プルリクエストを発行してください。 内容を確認の上、承認 or 否認をいたします。

ですので、無断でのプッシュはご遠慮願います。

また、バグ報告などはIssueにお気軽に投稿してください。 返答 or 修正対応をいたします。



[^CC]: heis総合クライアント"Compreheisive Client"の略。
[^PS]: 本ソフト(疑似サーバ=PseudoServer)の略。
[^設定]: 設定ファイルについての詳細は、HeisClient_CC/doc/説明書/設定ガイド.pdfを参照してください。

